# -*- coding: utf-8 -*-
"""
Created on Mon Sep 20 16:56:38 2021

@author: dludwinski
"""

import pandas as pd
#import numpy as np
#import re

cpayments = pd.read_csv (r"C:\Users\dludwinski\Desktop\PaymentsByWebReport.csv",
                         usecols=["Policy #", "Insured",
                                  "UserName", "Credit Cards", "Date"])
cpayments.rename(columns={"Credit Cards": "Payment Amount"}, inplace=True)

apayments = pd.read_csv (r"C:\Users\dludwinski\Desktop\PaymentsByWebReport (1).csv",
                         usecols=["Policy #", "Insured",
                                  "UserName", "ACH", "Date"])
apayments.rename(columns={"ACH": "Payment Amount"}, inplace=True)

payments = pd.concat([cpayments, apayments])
payments.reset_index(drop=True, inplace=True)


saves = pd.read_csv (r"C:\Users\dludwinski\Desktop\Cancels and Saves By User.csv",
                     usecols=["PolicyNumber", "SaveMethod", "SaveUser", "SaveDate"])
saves.dropna(inplace=True)

audit = saves.loc[saves["SaveMethod"].str.startswith("Collected")]
audit.reset_index(drop=True, inplace=True)

audit = audit.loc[audit["SaveDate"].str.startswith("9/")]
audit.reset_index(drop=True, inplace=True)

saves1 = pd.read_csv (r"C:\Users\dludwinski\Desktop\Cancels and Saves By User (1).csv",
                     usecols=["PolicyNumber", "SaveMethod", "SaveUser", "SaveDate"])
saves1.dropna(inplace=True)


audit1 = saves1.loc[saves1["SaveMethod"].str.startswith("Collected")]
audit1.reset_index(drop=True, inplace=True)

audit1 = audit1.loc[audit1["SaveDate"].str.startswith("9/")]
audit1.reset_index(drop=True, inplace=True)

audit = pd.concat([audit, audit1])
audit.sort_values("SaveUser", inplace=True)

""" Insert blank column for saves vs. 
payments audit then complete the audit """

payments.insert(1, "Collected?", "")

pays = payments["Policy #"].to_numpy()[:, None]
sa = audit["PolicyNumber"].to_numpy()

payments["Collected?"] = ((pays == sa).sum(axis=1))

paycount = payments.groupby("UserName").sum()


merged = pd.merge(payments, audit, left_on="Policy #",
                  right_on="PolicyNumber", how="inner")
merged = merged.drop_duplicates(subset="Insured", keep="first")
merged.reset_index(drop=True, inplace=True)

print(merged)

merged.to_excel(r"C:\Users\dludwinski\Desktop\paymentaudit2.xlsx", index=False)

#merged = merged.groupby("SaveUser")

#print(merged["Collected?"].count())
#print(merged["Payment Amount"])

